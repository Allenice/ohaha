<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Ohana by Allenice</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Ohana</h1>
      <h2 class="project-tagline">A simple server that return fake json data for test</h2>
      <a href="https://github.com/Allenice/ohana" class="btn">View on GitHub</a>
      <a href="https://github.com/Allenice/ohana/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Allenice/ohana/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="ohana" class="anchor" href="#ohana" aria-hidden="true"><span class="octicon octicon-link"></span></a>ohana</h1>

<p>一个返回模拟 json 数据的 http 服务器
特点：</p>

<ul>
<li>使用 mockjs 生成 json 数据</li>
<li>RESTFul</li>
<li>可跨域访问</li>
<li>http 代理转发</li>
</ul>

<h2>
<a id="安装" class="anchor" href="#%E5%AE%89%E8%A3%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装</h2>

<div class="highlight highlight-bash"><pre>npm install ohana</pre></div>

<h2>
<a id="使用" class="anchor" href="#%E4%BD%BF%E7%94%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用</h2>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> Server <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>ohana<span class="pl-pds">"</span></span>);
<span class="pl-k">var</span> server <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Server</span>();

server.get(<span class="pl-s"><span class="pl-pds">'</span>/article/<span class="pl-pds">'</span></span>, {
    delay<span class="pl-k">:</span> <span class="pl-c1">200</span>,
    <span class="pl-en">data</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">params</span>, <span class="pl-smi">query</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(params);
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(query);

        <span class="pl-k">return</span> {
            <span class="pl-s"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>ok<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>total_count<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">100</span>,
            <span class="pl-s"><span class="pl-pds">"</span>data|10<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
                {
                    <span class="pl-s"><span class="pl-pds">"</span>id|1-10000<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1</span>,
                    <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>@TITLE(5, 7)<span class="pl-pds">"</span></span>,
                    <span class="pl-s"><span class="pl-pds">"</span>author<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>@NAME<span class="pl-pds">"</span></span>,
                    <span class="pl-s"><span class="pl-pds">"</span>post_time<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>@DATETIME('yyyy-MM-dd HH:mm:ss')<span class="pl-pds">"</span></span>,
                    <span class="pl-s"><span class="pl-pds">"</span>read_count|0-1000<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">100</span>
                }
            ]
        }
    }
});

server.<span class="pl-c1">start</span>(<span class="pl-c1">3000</span>);
</pre></div>

<h2>
<a id="api" class="anchor" href="#api" aria-hidden="true"><span class="octicon octicon-link"></span></a>API</h2>

<h3>
<a id="servergetpath-options" class="anchor" href="#servergetpath-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>server.get(path, options)</h3>

<p>匹配 GET 方式的请求。</p>

<ul>
<li>path: 路由匹配地址</li>
<li>options: 

<ul>
<li>delay: 延迟多少毫秒后返回，</li>
<li>data: 返回的数据，可以接受对象和方法, 方法中的参数 params 是路由匹配的参数，query 是提交或查询的参数。</li>
</ul>
</li>
</ul>

<div class="highlight highlight-javascript"><pre>server.get(<span class="pl-s"><span class="pl-pds">'</span>/article/:id<span class="pl-pds">'</span></span>, {
    <span class="pl-en">data</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">params</span>, <span class="pl-smi">query</span>) {
        <span class="pl-k">return</span> {
            <span class="pl-s"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>ok<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
                <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span><span class="pl-k">:</span> params.<span class="pl-c1">id</span>,
                <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>@TITLE(5, 7)<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>author<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>@NAME<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>post_time<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>@DATETIME('yyyy-MM-dd HH:mm:ss')<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>content<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>@PARAGRAPH(2)<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>poster<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>@IMAGE('700x350', '#ccc', '#000', 'hello world')<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>read_count|0-1000<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">100</span>
            }
        }
    }
});</pre></div>

<h3>
<a id="serverpostpath-options" class="anchor" href="#serverpostpath-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>server.post(path, options）</h3>

<p>与 get 同理</p>

<h3>
<a id="serverdeletepath-options" class="anchor" href="#serverdeletepath-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>server.delete(path, options)</h3>

<p>与 get 同理</p>

<h3>
<a id="serverputpath-options" class="anchor" href="#serverputpath-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>server.put(path, options)</h3>

<p>与 get 同理</p>

<h3>
<a id="serverpatchpath-options" class="anchor" href="#serverpatchpath-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>server.patch(path, options)</h3>

<p>与 get 同理</p>

<h3>
<a id="serverproxypath-option" class="anchor" href="#serverproxypath-option" aria-hidden="true"><span class="octicon octicon-link"></span></a>server.proxy(path, option)</h3>

<p>代理请求</p>

<ul>
<li>path: 路由匹配地址</li>
<li>options: 

<ul>
<li>urlRoot:  目标服务器请求根目录，</li>
<li>method:  请求类型，GET | POST | PUT | PATCH | DELETE</li>
</ul>
</li>
</ul>

<div class="highlight highlight-javascript"><pre>server.proxy(<span class="pl-s"><span class="pl-pds">'</span>/article/:id<span class="pl-pds">'</span></span>, {
    urlRoot<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>http://localhost:3000<span class="pl-pds">'</span></span>,
    method<span class="pl-k">:</span> <span class="pl-c1">DELETE</span>
});

<span class="pl-c">// 可以设置全局默认配置</span>
server.setProxyDefault({
  urlRoot<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>http://localhost:3000<span class="pl-pds">'</span></span>,
  method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>
});

<span class="pl-c">// 之后可以省略配置</span>
server.proxy(<span class="pl-s"><span class="pl-pds">'</span>/article/<span class="pl-pds">'</span></span>);

server.proxy(<span class="pl-s"><span class="pl-pds">'</span>/article/:id<span class="pl-pds">'</span></span>);

server.proxy(<span class="pl-s"><span class="pl-pds">'</span>/article/<span class="pl-pds">'</span></span>, {
  method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>POST<span class="pl-pds">'</span></span>
});

server.proxy(<span class="pl-s"><span class="pl-pds">'</span>/article/:id<span class="pl-pds">'</span></span>, {
  method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>DELETE<span class="pl-pds">'</span></span>
});

server.proxy(<span class="pl-s"><span class="pl-pds">'</span>/article/:id<span class="pl-pds">'</span></span>, {
  method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>PUT<span class="pl-pds">'</span></span>
});

server.proxy(<span class="pl-s"><span class="pl-pds">'</span>/article/:id<span class="pl-pds">'</span></span>, {
  method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>PATCH<span class="pl-pds">'</span></span>
});</pre></div>

<h3>
<a id="serverregisterapilist" class="anchor" href="#serverregisterapilist" aria-hidden="true"><span class="octicon octicon-link"></span></a>server.register(apiList);</h3>

<p>注册 api</p>

<ul>
<li>apiList:  api 模块列表</li>
</ul>

<div class="highlight highlight-javascript"><pre>server.register([
    <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./article/index<span class="pl-pds">'</span></span>),
    <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./user/index<span class="pl-pds">'</span></span>)
]);</pre></div>

<h3>
<a id="serverstartport-host" class="anchor" href="#serverstartport-host" aria-hidden="true"><span class="octicon octicon-link"></span></a>server.start(port, host)</h3>

<ul>
<li>port:  服务器监听的网络端口</li>
<li>host： 主机</li>
</ul>

<h2>
<a id="路由匹配规则" class="anchor" href="#%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99" aria-hidden="true"><span class="octicon octicon-link"></span></a>路由匹配规则：:</h2>

<p>字符串:</p>

<pre><code>"/articles" 只会匹配到 "/articles"。 /articles/ 不会被匹配到。
</code></pre>

<p>命名参数:</p>

<pre><code>"/articles/:title" 只会匹配到像"/articles/hello"的路由, 但是不会匹配到 "/articles/".
</code></pre>

<p>可选参数:</p>

<pre><code>"/articles/:title?" 匹配 "/articles/hello" 和 "/articles/"。
</code></pre>

<p>可选参数前面的参数也是可选的:</p>

<pre><code>"/:n.:f?" 会匹配到 "/1" 和 "/1.json"
</code></pre>

<p>星号（splat）:</p>

<pre><code>"/assets/*" 匹配到 "/assets/blah/blah/blah.png" 和 "/assets/".

"/assets/*.*" 会匹配到 "/assets/1/2/3.js"， 并且有 splats: ["1/2/3", "js"]
</code></pre>

<p>星号和命名参数:</p>

<pre><code>"/account/:id/assets/*" 会匹配到 "/account/2/assets/folder.png"，并且有 params: {id: 2}, splats:["folder.png"]
</code></pre>

<p>正则表达式:</p>

<pre><code>"/lang/:lang([a-z]{2})" 会匹配到 "/lang/en", 但是不会匹配到 "/lang/12" 和 "/lang/eng"
</code></pre>

<p>参考： <a href="https://github.com/aaronblohowiak/routes.js">https://github.com/aaronblohowiak/routes.js</a></p>

<h2>
<a id="数据生成" class="anchor" href="#%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>数据生成</h2>

<p>ohana 默认集成了 mockjs，你可以使用 mockjs 生成 json 数据。当然你也可以使用其他的生成工具。
参考文档： <a href="http://mockjs.com/editor.html#help">http://mockjs.com/editor.html#help</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Allenice/ohana">Ohana</a> is maintained by <a href="https://github.com/Allenice">Allenice</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

